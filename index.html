<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="mapea" content="yes">
    <title>Arquetipo Visualizador</title>
    
    <!-- <link type="text/css" rel="stylesheet" href="https://mapea-lite-6.desarrollo.guadaltel.es/api-core/assets/css/apiign.ol.min.css">
    <link href="https://mapea-lite-6.desarrollo.guadaltel.es/api-core/plugins/ignsearch/ignsearch.ol.min.css" rel="stylesheet" />
    <link href="https://mapea-lite-6.desarrollo.guadaltel.es/api-core/plugins/toc/toc.ol.min.css" rel="stylesheet" />
    <link href="https://mapea-lite-6.desarrollo.guadaltel.es/api-core/plugins/backimglayer/backimglayer.ol.min.css" rel="stylesheet" />
    <link href="https://mapea-lite-6.desarrollo.guadaltel.es/api-core/plugins/mousesrs/mousesrs.ol.min.css" rel="stylesheet" />
    <link href="https://mapea-lite-6.desarrollo.guadaltel.es/api-core/plugins/xylocator/xylocator.ol.min.css" rel="stylesheet" /> -->

    <link type="text/css" rel="stylesheet" href="https://componentes.cnig.es/api-core/assets/css/apiign.ol.min.css">
    <link href="https://componentes.cnig.es/api-core/plugins/ignsearch/ignsearch.ol.min.css" rel="stylesheet" />
    <link href="https://componentes.cnig.es/api-core/plugins/toc/toc.ol.min.css" rel="stylesheet" />
    <link href="https://componentes.cnig.es/api-core/plugins/backimglayer/backimglayer.ol.min.css" rel="stylesheet" />
    <link href="https://componentes.cnig.es/api-core/plugins/mousesrs/mousesrs.ol.min.css" rel="stylesheet" />
    <link href="https://componentes.cnig.es/api-core/plugins/xylocator/xylocator.ol.min.css" rel="stylesheet" />
    <link href="https://componentes.cnig.es/api-core/plugins/comparepanel/comparepanel.ol.min.css" rel="stylesheet" />


    <style type="text/css">
        html,
        body {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
        }
    </style>

</head>

<body>
    <div id="mapjs" class="m-container"></div>
    
    <!-- <script type="text/javascript" src="https://mapea-lite-6.desarrollo.guadaltel.es/api-core/js/apiign.ol.min.js"></script>
    <script type="text/javascript" src="https://mapea-lite-6.desarrollo.guadaltel.es/api-core/js/configuration.js"></script>
    <script type="text/javascript" src="https://mapea-lite-6.desarrollo.guadaltel.es/api-core/plugins/ignsearch/ignsearch.ol.min.js"></script>
    <script type="text/javascript" src="https://mapea-lite-6.desarrollo.guadaltel.es/api-core/plugins/toc/toc.ol.min.js"></script>
    <script type="text/javascript" src="https://mapea-lite-6.desarrollo.guadaltel.es/api-core/plugins/backimglayer/backimglayer.ol.min.js"></script>
    <script type="text/javascript" src="https://mapea-lite-6.desarrollo.guadaltel.es/api-core/plugins/mousesrs/mousesrs.ol.min.js"></script>
    <script type="text/javascript" src="https://mapea-lite-6.desarrollo.guadaltel.es/api-core/plugins/xylocator/xylocator.ol.min.js"></script> -->

    <script type="text/javascript" src="https://componentes.cnig.es/api-core/js/apiign.ol.min.js"></script>
    <script type="text/javascript" src="https://componentes.cnig.es/api-core/js/configuration.js"></script>
    <script type="text/javascript" src="https://componentes.cnig.es/api-core/plugins/ignsearch/ignsearch.ol.min.js"></script>
    <script type="text/javascript" src="https://componentes.cnig.es/api-core/plugins/toc/toc.ol.min.js"></script>
    <script type="text/javascript" src="https://componentes.cnig.es/api-core/plugins/backimglayer/backimglayer.ol.min.js"></script>
    <script type="text/javascript" src="https://componentes.cnig.es/api-core/plugins/mousesrs/mousesrs.ol.min.js"></script>
    <script type="text/javascript" src="https://componentes.cnig.es/api-core/plugins/xylocator/xylocator.ol.min.js"></script>
    <script type="text/javascript" src="https://componentes.cnig.es/api-core/plugins/comparepanel/comparepanel.ol.min.js"></script>

    <script type="text/javascript">
    
    
        // Configuración de backgroundlayers para EPSG:4326
        //http://mapea-lite.desarrollo.guadaltel.es/api-core/
        // M.config.backgroundlayers[0].layers = ['WMTS*https://www.ign.es/wmts/ign-base?*IGNBaseTodo*EPSG:4326*base*false*image/jpeg*false*false*true'];
        // M.config.backgroundlayers[1].layers = ['WMTS*https://www.ign.es/wmts/pnoa-ma?*OI.OrthoimageCoverage*EPSG:4326*imagen*false*image/jpeg*false*false*true'];
        // M.config.backgroundlayers[2].layers = [
        //     'WMTS*https://www.ign.es/wmts/pnoa-ma?*OI.OrthoimageCoverage*EPSG:4326*imagen*true*image/jpeg*false*false*true',
        //     'WMTS*https://www.ign.es/wmts/ign-base?*IGNBaseOrto*EPSG:4326*Callejero*true*image/png*false*false*true'
        // ];

/*
IGNBase:
Capa IGNBaseTodo (hasta nivel 17): https://tms-ign-base.ign.es/1.0.0/IGNBaseTodo/{z}/{x}/{-y}.jpeg
Capa IGNBseOrto (hasta nivel 16): https://tms-ign-base.ign.es/1.0.0/IGNBaseOrto/{z}/{x}/{-y}.png
•                    Mapa Raster (hasta nivel 17): https://tms-mapa-raster.ign.es/1.0.0/mapa-raster/{z}/{x}/{-y}.jpeg
•                    PNOA MA (hasta nivel 19): https://www.'https.com/tms-pnoa-ma.ign.es/1.0.0/pnoa-ma/{z}/{x}/{-y}.jpeg
*/




    M.proxy(true);//Si lo pongo a false no van las peticiones a otros dominios (Problemas CORS)
    M.config.attributions.defaultAttribution = 'Instituto Geográfico Nacional';
    M.config.attributions.defaultURL = 'https://www.ign.es';


    const map = M.map({
        container: 'mapjs',
        controls: ['panzoom', 'scale*true', 'scaleline', 'rotate', 'location'],
        // controls: ['panzoom', 'scale*true', 'scaleline', 'rotate', 'location', 'backgroundlayers', 'getfeatureinfo'],
        zoom: 14,
        maxZoom: 20,
        minZoom: 4,
        projection: "EPSG:3857*m",
        center: {
            x: -1990745,
            y: 3326753,
            draw: false  //Dibuja un punto en el lugar de la coordenada
        },
    });

    //const urlBase='https://projects.develmap.com/apicnig/lapalma/';
    const urlBase='https://www.ign.es/resources/viewer/lapalma/';
    

    /**
     * Definismos ejempls de capas TMS y XYZ
     * 
     */

    //  const xyzOSM = new M.layer.XYZ({
    //     url: 'http://tile.openstreetmap.org/{z}/{x}/{y}.png',
    //     name: 'OSM Standard',
    //     projection: 'EPSG:3857',
    //     visibility: false,
    // });
    // map.addXYZ(xyzOSM);

    // Otras disponibles: https://www.ign.es/web/catalogo-cartoteca/resources/webmaps/data/cresques/{z}/{x}/{y}.jpg
    // const xyzIGME = new M.layer.XYZ({
    //     url: 'https://mapas.igme.es/gis/rest/services/Cartografia_Geologica/IGME_Geode_50/MapServer/tile/{z}/{y}/{x}',
    //     name: 'Mapa geológico del IGME',
    //     projection: 'EPSG:3857',
    //     visibility: false,
    // });
    // map.addXYZ(xyzIGME);

    /**
     * Configuración de capas WMS
     */
    const wmsTransporte = new M.layer.WMS({
        url: 'https://servicios.idee.es/wms-inspire/transportes?',
        name: 'TN.RoadTransportNetwork.RoadLink',
        legend: 'Red de carreteras',
        tiled: false,
        visibility: false,
    }, {
        styles: 'TN.RoadTransportNetwork.RoadLink.Default'
    });

    const wmsUA = new M.layer.WMS({
        url: 'https://www.ign.es/wms-inspire/unidades-administrativas?',
        name: 'AU.AdministrativeUnit',
        legend: 'Unidades administrativas',
        tiled: false,
        visibility: true,
    }, {
        styles: 'ua-comparador'
    });

    //https://www.ign.es/wms-inspire/geofisica?SERVICE=WMS&REQUEST=GetMap&FORMAT=image/png&TRANSPARENT=TRUE&STYLES=&VERSION=1.3.0&LAYERS=Ultimos10dias&WIDTH=1920&HEIGHT=840&CRS=EPSG:3857&BBOX=-1991678.454621574,3325703.129268209,-1987092.2329251016,3327709.6012604157
    const wmsGeofisica = new M.layer.WMS({
        url: 'https://www.ign.es/wms-inspire/geofisica?',
        name: 'Ultimos10dias',
        legend: 'Terremotos últimos 10 días',
        tiled: false,
        visibility: true,
    }, {
        format: 'image/jpeg',        
    });

    const wmsCatastro = new M.layer.WMS({
        url: 'https://ovc.catastro.meh.es/Cartografia/WMS/ServidorWMS.aspx?version:1.1.1',
        name: 'Catastro',
        legend: 'Catastro',
        version: '1.1.1',
        tiled: false,
        visibility: false,
    }, {});


/**
 * https://ovc.catastro.meh.es/Cartografia/WMS/ServidorWMS.aspx?
 * SERVICE=WMS&REQUEST=GetMap&FORMAT=image/png&TRANSPARENT=TRUE&STYLES=&VERSION=1.1.1&LAYERS=Catastro&WIDTH=1920&HEIGHT=897&SRS=EPSG:3857
 * &BBOX=-1991675.1985649685,3325957.2011352074,-1990528.6431408506,3326492.8574974122&_ts=1632415925731
*/

    map.addLayers([wmsGeofisica,wmsUA,wmsTransporte,wmsCatastro]);
    wmsGeofisica.setZIndex(4600);
    wmsUA.setZIndex(4601);
    wmsTransporte.setZIndex(4602);
    wmsCatastro.setZIndex(4603);
    // map.addLayers([wmsGeofisica,wmsUA]);

    /**
     * Configuración de capas Vectoriales
     * 
     * https://info.igme.es/visor/?Configuracion=Enjambre-Terremotos-La-Palma&Extension=-18.059872,28.43841,-17.6369,28.91672,4326
     * https://emergency.copernicus.eu/mapping/list-of-components/EMSR546
     https://emergency.copernicus.eu/mapping/list-of-components/EMSR546
     http://info.igme.es/eventos/Erupcion-volcanica-la-palma#79
     https://info.igme.es/visor/?Configuracion=Enjambre-Terremotos-La-Palma&Extension=-18.059872,28.43841,-17.6369,28.91672,4326
     https://ign-esp.maps.arcgis.com/apps/webappviewer/index.html?id=0e18d39679a54e3cb4a3b434b31a743b
     */

    const vectorColada01 = new M.layer.GeoJSON({
        name: 'Estimación colada 2021-09-20 13:24 UTC',
        url: urlBase + 'data/colada20210920-1324.geojson',
        extract: false,
        
    },{
        visibility: false,
    });

    const vectorColada02 = new M.layer.GeoJSON({
        name: 'Estimación colada 2021-09-21 07:14 UTC',
        url: urlBase + 'data/colada20210921-0714.geojson',
        extract: false,
        
    },{
        visibility: false,
    });

    const vectorColada03 = new M.layer.GeoJSON({
        name: 'Estimación colada 2021-09-22 19:26 UTC',
        url: urlBase + 'data/colada20210922-1926.geojson',
        extract: false,
        
    },{
        visibility: false,
    });

    const vectorColada04 = new M.layer.GeoJSON({
        name: 'Estimación colada 2021-09-23 06:14 UTC',
        url: urlBase + 'data/colada20210923-0614.geojson',
        extract: false,
        
    },{
        visibility: true,
    });

    const vectorVolcano = new M.layer.GeoJSON({
        name: "Situación del volcán Cumbre Vieja",
        url: urlBase + 'data/volcano.geojson',
        extract: false,
        
    },{
        visibility: true,
    });

    map.addLayers([vectorColada01,vectorColada02,vectorColada03,vectorColada04,vectorVolcano]);

    // Punto de tamaño 5 con relleno verde semitransparente y borde rojo
    let estiloVerde = new M.style.Point({
        radius: 5,
        fill: {
            color: 'green',
            opacity: 0.5
        },
        stroke: {
            color: '#FF0000'
        }
    });

    let estiloRojo = new M.style.Point({
        radius: 5,
        fill: {
            color: 'green',
            opacity: 0.5
        },
        stroke: {
            color: '#FF0000'
        }
    });


        let estiloVolcan = new M.style.Point({
            icon: {
                src: urlBase + 'img/signal-volcano.png',
                scale: 0.10,
            },
            label: {
                text: 'Cumbre Vieja',
                font: 'bold italic 16px Courier New',
                //escala de la etiqueta
                scale: 0.9,
                //desplazamiento de la etiqueta en píxeles [x,y]
                offset: [0, 25],
            }
        });


    let estiloPoint = new M.style.Point({
        /*fill: {
            color: function(feature,map) {
                var colorPunto;
                if (feature.getAttribute('propietario').trim()==='IGNE, Servicio de Programas Geodésicos'){
                    colorPunto = 'green';
                }else{
                    colorPunto = 'red';
                }
                return colorPunto;
            },
            opacity: 0.7
        },
        stroke: {
            color: 'yellow',
            width: 2
        },
        radius: 8,*/
        icon: {
            // Forma del fontsymbol.
            // BAN|BLAZON|BUBBLE|CIRCLE|LOZENGE|MARKER
            // NONE|SHIELD|SIGN|SQUARE|TRIANGLE
            form: function (feature, map) {
                if (feature.getAttribute('propietario').trim() === 'IGNE, Servicio de Programas Geodésicos') {
                    return M.style.form.TRIANGLE;
                } else {
                    return M.style.form.CIRCLE;
                }

            },
            fontsize: 0.5,
            radius: 8,                    // Tamaño
            rotation: 0,                  // Giro del icono en radianes
            rotate: false,                // Activar rotacion con dispositivo
            offset: [0, 0],               // Desplazamiento en pixeles en los ejes x,y
            color: 'black',
            fill: function (feature, map) {
                var colorPunto;
                if ((feature.getAttribute('estado') === 'Emitiendo')) {
                    colorPunto = 'green';
                    /*}else if ((feature.getAttribute('Bocata_Beb')==='No') && (feature.getAttribute('Comida_Pre')==='No') && (feature.getAttribute('Ducha')==='Sí')){
                        colorPunto = 'blue';
                    }else if ((feature.getAttribute('Bocata_Beb')==='Sí' || feature.getAttribute('Comida_Pre')==='Sí') && (feature.getAttribute('Ducha')==='No')){
                        colorPunto = 'yellow';*/
                } else {
                    colorPunto = 'red';
                }
                return colorPunto;
            },//'#8A0829',              // Color de relleno
            gradientcolor: '#088A85',     // Color del borde
            //gradient: true,               // Degradado entre color de borde e interior
            opacity: 0.5                  // Transparencia. 0(transparente)|1(opaco)
        }
    });

        let stylePol = new M.style.Polygon({
                //Relleno del polígono
                fill: {
                    //patrón de relleno
                    color:"#0000ff",
                    opacity: 0.10,
                    // pattern: {
                    //     /**
                    //      * M.style.pattern.
                    //      * HATCH | CROSS | DOT | CIRCLE | SQUARE | TILE | WOVEN | CROSSES | CAPS | NYLON | HEXAGON | CEMETRY
                    //      * SAND | CONGLOMERATE | GRAVEL | BRICK | DOLOMITE | COAL | BRECCIA | CLAY | FLOODED | CHAOS | GRASS
                    //      * SWAMP | WAVE | VINE | FOREST | SCRUB | TREE | PINE | PINES | ROCK | ROCKS | CHARACTER | ICON | IMAGE
                    //     */
                    //     name: M.style.pattern.BRICK,
                    //     /*src: 'https://componentes.cnig.es/img/volcano.png',
                    //     offset: [51, 51],*/ 
                    //     size: 5,
                    //     scale: 1.3,
                    //     spacing: 10,
                    //     rotation: 20,
                    //     scale: 0.50,
                    //     /*name: M.style.pattern.IMAGE,
                    //     src: 'https://componentes.cnig.es/img/volcano.png',
                    //     offset: [51, 51],       
                    //     fill: {
                    //          color: '#fff',
                    //          opacity: 0.5
                    //     }*/
                    //     //SOLO ICONO:
                    //     //si name=ICON
                    //     /*'class': 'g-cartografia-save', 
                    //     //si name=IMAGE
                    //     'src': 'http://www.juntadeandalucia.es/prueba/icon.png',
                    //     "offset": [21, 21],       
                    //     "fill": {
                    //       'color': '#fff',
                    //       'opacity': 0.5
                    //     }*/
                    // }
                },
                //línea del polígono
                stroke: {
                    color: '#3397db',
                    width: 4,
                    linedash: [5,10], // Patrón de distancias
                    linedashoffset: 1,  // Offset de fase
                    linecap: 'square',  // Estilo de final de linea. round|square|butt
                    linejoin: 'miter',  // Estilo de conexión de segmentos. miter|round|bevel
                    miterlimit: 15      // Tamaño máximo segmento de conexión                    
                },
                //etiqueta del polígono
                // label: {
                //     //texto de la etiqueta: fijo, función o atributo
                //     text: 'Colada',
                //     //fuente de la etiqueta
                //     font: 'bold italic 16px Courier New',
                //     //escala de la etiqueta
                //     scale: 0.9,
                //     //desplazamiento de la etiqueta en píxeles [x,y]
                //     offset: [10, 0],
                //     //color del texto
                //     color: '#000',
                //     //borde del texto
                //     stroke: {
                //         //color del borde
                //         color: '#FFF',
                //         //tamaño del borde
                //         width: 5,
                //         /*linedash: [1, 20], //????
                //         linedashoffset: 60,
                //         linecap: 'square',
                //         linejoin: 'miter',
                //         miterlimit: 15*/
                //     },
                //     rotate: false, //¿¿no hace nada??
                //     //rotación de la etiqueta
                //     rotation: 0.3,
                //     // Alineación horizontal respecto a la geometría
                //     // CENTER|LEFT|RIGHT
                //     align: M.style.align.CENTER,
                //     // Alineación vertical respecto a la etiqueta
                //     // TOP|BOTTOM|MIDDLE
                //     baseline: M.style.baseline.TOP
                // }
            });

            let stylePolLast = new M.style.Polygon({
                //Relleno del polígono
                fill: {
                    //patrón de relleno
                    color:"#ff0000",
                    opacity: 0.25,
                    // pattern: {
                    //     /**
                    //      * M.style.pattern.
                    //      * HATCH | CROSS | DOT | CIRCLE | SQUARE | TILE | WOVEN | CROSSES | CAPS | NYLON | HEXAGON | CEMETRY
                    //      * SAND | CONGLOMERATE | GRAVEL | BRICK | DOLOMITE | COAL | BRECCIA | CLAY | FLOODED | CHAOS | GRASS
                    //      * SWAMP | WAVE | VINE | FOREST | SCRUB | TREE | PINE | PINES | ROCK | ROCKS | CHARACTER | ICON | IMAGE
                    //     */
                    //     name: M.style.pattern.BRICK,
                    //     /*src: 'https://componentes.cnig.es/img/volcano.png',
                    //     offset: [51, 51],*/ 
                    //     size: 5,
                    //     scale: 1.3,
                    //     spacing: 10,
                    //     rotation: 20,
                    //     scale: 0.50,
                    //     /*name: M.style.pattern.IMAGE,
                    //     src: 'https://componentes.cnig.es/img/volcano.png',
                    //     offset: [51, 51],       
                    //     fill: {
                    //          color: '#fff',
                    //          opacity: 0.5
                    //     }*/
                    //     //SOLO ICONO:
                    //     //si name=ICON
                    //     /*'class': 'g-cartografia-save', 
                    //     //si name=IMAGE
                    //     'src': 'http://www.juntadeandalucia.es/prueba/icon.png',
                    //     "offset": [21, 21],       
                    //     "fill": {
                    //       'color': '#fff',
                    //       'opacity': 0.5
                    //     }*/
                    // }
                },
                //línea del polígono
                stroke: {
                    color: '#ff5588',
                    width: 4,
                },
                //etiqueta del polígono
                // label: {
                //     //texto de la etiqueta: fijo, función o atributo
                //     text: 'Colada',
                //     //fuente de la etiqueta
                //     font: 'bold italic 16px Courier New',
                //     //escala de la etiqueta
                //     scale: 0.9,
                //     //desplazamiento de la etiqueta en píxeles [x,y]
                //     offset: [10, 0],
                //     //color del texto
                //     color: '#000',
                //     //borde del texto
                //     stroke: {
                //         //color del borde
                //         color: '#FFF',
                //         //tamaño del borde
                //         width: 5,
                //         /*linedash: [1, 20], //????
                //         linedashoffset: 60,
                //         linecap: 'square',
                //         linejoin: 'miter',
                //         miterlimit: 15*/
                //     },
                //     rotate: false, //¿¿no hace nada??
                //     //rotación de la etiqueta
                //     rotation: 0.3,
                //     // Alineación horizontal respecto a la geometría
                //     // CENTER|LEFT|RIGHT
                //     align: M.style.align.CENTER,
                //     // Alineación vertical respecto a la etiqueta
                //     // TOP|BOTTOM|MIDDLE
                //     baseline: M.style.baseline.TOP
                // }
            });



    vectorColada01.setStyle(stylePol);
    vectorColada02.setStyle(stylePol);
    vectorColada03.setStyle(stylePol);
    vectorColada04.setStyle(stylePolLast);
    vectorVolcano.setStyle(estiloVolcan);
    vectorColada01.setZIndex(5000);
    vectorColada02.setZIndex(5001);
    vectorColada03.setZIndex(5002);
    vectorColada04.setZIndex(5003);
    vectorVolcano.setZIndex(5004);
    

    /**
     * Definimos capas WMTS con notación standard
     * 
     */
    const wmtsMTN251edi = new M.layer.WMTS({
        url: "http://www.ign.es/wmts/primera-edicion-mtn",
        name: "mtn25-edicion1",
        matrixSet: "GoogleMapsCompatible",
        legend: "Primera edición MTN25"
    }, {
        format: 'image/jpeg'
    });

    const wmtsMTN501edi = new M.layer.WMTS({
        url: "http://www.ign.es/wmts/primera-edicion-mtn",
        name: "mtn50-edicion1",
        matrixSet: "GoogleMapsCompatible",
        legend: "Primera edición MTN50"
    }, {
        format: 'image/jpeg'
    });

    const wmtsMTNActual = new M.layer.WMTS({
        url: "https://www.ign.es/wmts/mapa-raster",
        name: "MTN",
        matrixSet: "GoogleMapsCompatible",
        legend: "Cartografía Ráster Actual"
    }, {
        format: 'image/jpeg'
    });

    const wmtssiose = new M.layer.WMTS({
        url: "https://servicios.idee.es/wmts/ocupacion-suelo",
        name: "LC.LandCoverSurfaces",
        matrixSet: "GoogleMapsCompatible",
        legend: "CORINE / SIOSE"
    }, {
        format: 'image/jpeg'
    });

    const wmtsmdt = new M.layer.WMTS({
        url: "https://servicios.idee.es/wmts/mdt",
        name: "Relieve",
        matrixSet: "GoogleMapsCompatible",
        legend: "MDT"
    }, {
        format: 'image/jpeg'
    });

    

    

    // const tmsBaseOrto = new M.layer.TMS({
    //     url: 'https://tms-ign-base.ign.es/1.0.0/IGNBaseOrto/{z}/{x}/{-y}.png',
    //     name: 'TMS IGNBaseOrto',
    //     projection: 'EPSG:3857',
    //     visibility: false,
    // });
    // map.addTMS(tmsBaseOrto);

    // const tmsBaseIGN = new M.layer.TMS({
    //     url: 'https://tms-ign-base.ign.es/1.0.0/IGNBaseTodo/{z}/{x}/{-y}.jpeg',
    //     name: 'TMS IGN Base',
    //     projection: 'EPSG:3857',
    //     visibility: false,
    // });
    // map.addTMS(tmsBaseIGN);

    // const tmsMapaIGN = new M.layer.TMS({
    //     url: 'https://tms-mapa-raster.ign.es/1.0.0/mapa-raster/{z}/{x}/{-y}.jpeg',
    //     name: 'TMS MAPA IGN',
    //     projection: 'EPSG:3857',
    //     visibility: false,
    // });
    // map.addTMS(tmsMapaIGN);

    // const tmsPNOAIGN = new M.layer.TMS({
    //     url: 'https://tms-pnoa-ma.ign.es/1.0.0/pnoa-ma/{z}/{x}/{-y}.jpeg',
    //     name: 'TMS PNOA IGN',
    //     projection: 'EPSG:3857',
    //     visibility: false,
    // });
    // map.addTMS(tmsPNOAIGN);

    /*const tmsIGME = new M.layer.TMS({
        url: 'https://mapas.igme.es/gis/rest/services/Cartografia_Geologica/IGME_Geode_50/MapServer/tile/{z}/{x}/{y}.jpeg',
        name: 'IGME',
        projection: 'EPSG:3857',
        visibility: false,
    });
    map.addTMS(tmsIGME);
*/
    //https://mapas.igme.es/gis/rest/services/Cartografia_Geologica/IGME_Geode_50/MapServer/tile/16/27327/29515

    /**
     * Algunos plugins para ayudar en la configuración del mapa
     */

    const mp = new M.plugin.IGNSearch({
        servicesToSearch: 'gn',
        maxResults: 10,
        isCollapsed: false,
        noProcess: 'municipio,poblacion',
        countryCode: 'es',
        reverse: true,
    });

    const mp4 = new M.plugin.XYLocator({
        position: 'TL',
    });

    const mp7 = new M.plugin.MouseSRS({
        srs: 'EPSG:4326',
        label: 'WGS84',
        precision: 6,
        geoDecimalDigits: 4,
        utmDecimalDigits: 2,
    });

    const mp8 = new M.plugin.TOC({
        position: 'TL',
        collapsible: true,
        collapsed: false,
    });

        const mp9 = new M.plugin.BackImgLayer({
            position: 'TR',
            collapsible: true,
            collapsed: true,
            layerId: 0,
            layerVisibility: true,
            columnsNumber: 3,
            layerOpts: [
                // LiDAR Híbrido
                {
                    id: 'pnoa-hibido',
                    title: 'PNOA Híbrido',
                    preview: 'https://componentes.ign.es/api-core/plugins/backimglayer/images/svqhibrid.png',
                    layers: [new M.layer.WMTS({
                        url: 'https://www.ign.es/wmts/pnoa-ma?',
                        name: 'OI.OrthoimageCoverage',
                        legend: 'Imagen (PNOA)',
                        matrixSet: 'EPSG:4326',
                        transparent: true,
                        displayInLayerSwitcher: false,
                        queryable: false,
                        visible: true,
                        format: 'image/jpeg',
                    }),
                    new M.layer.WMTS({
                        url: 'https://www.ign.es/wmts/ign-base?',
                        name: 'IGNBaseOrto',
                        matrixSet: 'EPSG:4326',
                        legend: 'Mapa IGN',
                        transparent: false,
                        displayInLayerSwitcher: false,
                        queryable: false,
                        visible: true,
                        format: 'image/png',
                    })
                    ],
                },
                // PNOA Híbrido
                {
                    id: 'lidar-hibrido',
                    title: 'LiDAR Híbrido',
                    preview: 'https://componentes.ign.es/api-core/plugins/backimglayer/images/svqlidar.png',
                    layers: [new M.layer.WMTS({
                        url: 'https://wmts-mapa-lidar.idee.es/lidar?',
                        name: 'EL.GridCoverageDSM',
                        legend: 'Modelo Digital de Superficies LiDAR',
                        matrixSet: 'EPSG:4326',
                        transparent: true,
                        displayInLayerSwitcher: false,
                        queryable: false,
                        visible: true,
                        format: 'image/png',
                    }),
                    new M.layer.WMTS({
                        url: 'https://www.ign.es/wmts/ign-base?',
                        name: 'IGNBaseOrto',
                        matrixSet: 'EPSG:4326',
                        legend: 'Mapa IGN',
                        transparent: true,
                        displayInLayerSwitcher: false,
                        queryable: false,
                        visible: true,
                        format: 'image/png',
                    })
                    ],
                },
                // Mapa base
                {
                    id: 'mapa',
                    preview: 'https://componentes.ign.es/api-core/plugins/backimglayer/images/svqmapa.png',
                    title: 'Mapa',
                    layers: [new M.layer.WMTS({
                        url: 'https://www.ign.es/wmts/ign-base?',
                        name: 'IGNBaseTodo',
                        legend: 'Mapa IGN',
                        matrixSet: 'EPSG:4326',
                        transparent: false,
                        displayInLayerSwitcher: false,
                        queryable: false,
                        visible: true,
                        format: 'image/jpeg',
                    })],
                },                
                //PNOA sin textos
                {
                    id: 'imagen',
                    title: 'Imagen',
                    preview: 'https://componentes.ign.es/api-core/plugins/backimglayer/images/svqimagen.png',
                    layers: [new M.layer.WMTS({
                        url: 'https://www.ign.es/wmts/pnoa-ma?',
                        name: 'OI.OrthoimageCoverage',
                        legend: 'Imagen (PNOA)',
                        matrixSet: 'EPSG:4326',
                        transparent: false,
                        displayInLayerSwitcher: false,
                        queryable: false,
                        visible: true,
                        format: 'image/jpeg',
                    })],
                },
                // LiDAR sin textos
                {
                    id: 'lidar',
                    preview: 'https://componentes.ign.es/api-core/plugins/backimglayer/images/svqlidar.png',
                    title: 'LIDAR',
                    layers: [new M.layer.WMTS({
                        url: 'https://wmts-mapa-lidar.idee.es/lidar?',
                        name: 'EL.GridCoverageDSM',
                        legend: 'Modelo Digital de Superficies LiDAR',
                        matrixSet: 'EPSG:4326',
                        transparent: false,
                        displayInLayerSwitcher: false,
                        queryable: false,
                        visible: true,
                        format: 'image/png',
                    })],
                },
                // SIOSE
                {
                    id: 'SIOSE',
                    preview: 'img/siose.jpg',
                    title: 'CORINE / SIOSE',
                    layers: [wmtssiose],
                },
            ],
        }
        );

            let baseLayers = [
                ["SIGPAC", "2003", "WMS*SIGPAC*https://www.ign.es/wms/pnoa-historico*SIGPAC"],
                ["PNOA 2005", "2005", "WMS*pnoa2005*https://www.ign.es/wms/pnoa-historico*pnoa2005"],
                ["PNOA 2009", "2009", "WMS*pnoa2009*https://www.ign.es/wms/pnoa-historico*pnoa2009"],
                ["PNOA 2012", "2012", "WMS*pnoa2012*https://www.ign.es/wms/pnoa-historico*pnoa2012"],
                ["PNOA 2015", "2015", "WMS*pnoa2015*https://www.ign.es/wms/pnoa-historico*pnoa2015"],
                ["PNOA 2018", "2018", "WMS*pnoa2018*https://www.ign.es/wms/pnoa-historico*pnoa2018"],
            ];

                const mp10 = new M.plugin.Comparepanel({
                                    position: 'TL',
                                    baseLayers: baseLayers,
                                    mirrorpanelParams:{
                                        modeViz:1, 
                                    }
                });
            


    map.addPlugin(mp);
    map.addPlugin(mp4);
    map.addPlugin(mp7);
    map.addPlugin(mp8);
    map.addPlugin(mp9);
    map.addPlugin(mp10);


    


</script>
</body>

</html>